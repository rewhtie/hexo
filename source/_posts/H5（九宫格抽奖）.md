---
title: H5 实现九宫格抽奖
tag:
  - 功能模块
  - H5
---

H5 九宫格抽奖、实现思路

<!-- more -->

<font color="#08c"> 实现思路：每一次抽奖都是一个 list 数组，每次定时器执行 index 下标+1 取到 list 数组对应下标值，通过赋值判断添加高亮样式 </font>
<font color="#08c"> 所有的奖品都只是一张图片，抽奖区域设置透明背景置于图片上层，动态设置宽度、高度、间隔</font>


实现代码如下

```html
<template>
  <div class="run-light" :style="box_style">
    <div
      v-for="(item, index) in prizes"
      :key="index"
      :class="[index === prize && 'light', item.id === 4 && 'opacity']"
      @click="getPrize(index)"
      class="flex__center__center"
      :style="prize_style"
    >
      <!-- 九宫格中间镂空区域 -->
      <slot v-if="item.id === 4" />
    </div>
  </div>
</template>
```

```js
<script>
import { Toast } from "vant";
export default {
  name: "run",
  props: {
    // 格子宽度
    width: {
      type: [Number, String],
      default: 93
    },
    // 格子高度
    height: {
      type: [Number, String],
      default: 93
    },
    // 格子间隔
    gap: {
      type: [Number, String],
      default: 10
    },
    // 格子边框
    radius: {
      type: [Number, String],
      default: 10
    },
    // 抽奖次数
    number: [String, Number],
    // 是否禁用格子点击事件
    disabled: {
      type: Boolean,
      default: false
    }
  },
  data() {
    return {
      // 中奖
      prize: null,
      // 转盘旋转方向
      sort: [0, 1, 2, 5, 8, 7, 6, 3],
      // 奖品
      prizes: [
        { id: 0, name: "手机0" },
        { id: 1, name: "钱包1" },
        { id: 2, name: "iPhone11-2" },
        { id: 5, name: "华为P30-3" },
        { id: 4, name: "开始抽奖" },
        { id: 8, name: "Ipad-5" },
        { id: 7, name: "小米背包-6" },
        { id: 6, name: "小米鼠标-7" },
        { id: 3, name: "无线路由器-8" }
      ],
      // 记录最后一次抽奖停留位置
      endStop: null,
      // 按钮限制
      flag: true,
      // 转圈次数
      turns: 3,
      // 转动格数
      current: 0,
      // 定时器执行时间
      min: 0,
      // 执行速度
      speed: 150,
      // 实现变速运动
      diff: 75
    };
  },
  watch: {},
  computed: {
    // 整个抽奖区域
    prize_style() {
      return {
        width: this.width / 10 + "rem",
        height: this.height / 10 + "rem",
        ["border-radius"]: this.radius + "px"
      }
    },
    // 奖品格子
    box_style() {
      return {
        gap: this.gap / 10 + "rem",
        width: (this.width * 3 + this.gap * 2) / 10 + "rem"
      };
    }
  },
  methods: {
    start(res) {
      // 奖品1、2、3、4、5、5、6、7、8
      let random = res;
      // 第二次转盘需要把剩下的半圈转完
      let startArray = [];
      if (
        this.endStop != null
      ) {
        startArray = this.sort.slice(
          this.sort.indexOf(this.endStop),
          this.sort.length
        );
      }
      // 转几圈
      let array = [];
      for (let j = 1; j < this.turns; j++) {
        array = array.concat(this.sort);
      }
      // 最后一圈（不一定是一整圈）
      let lastArray = [];
      for (let i = 0; i < random; i++) {
        lastArray.push(this.sort[i]);
      }
      array = [...startArray, ...array, ...lastArray];
      // 改变索引实现转动效果
      this.startCircle(array, this.current);
    },
    startCircle(list, index) {
      // 转圈速度
      if (index >= 0) {
        this.min = this.speed;
      }
      if (index > 5 && index <= 20) {
        if (this.min >= 100) this.min -= this.diff;
      }
      if (index > 20 && index <= list.length) {
        this.min += this.diff;
      }
      // 转圈定时器执行
      window.timeout = setTimeout(() => {
        if (index == list.length) {
          // 清除定时器
          clearTimeout(window.timeout);
          // 清空跑格数
          this.current = 0;
          // 按钮禁用关闭
          this.flag = true;
          // 记录最后停留位置
          this.endStop = this.prize;
          // 清除定时器min
          this.min = this.speed;
        } else {
          this.prize = list[this.current];
          this.current++;
          this.startCircle(list, this.current);
        }
      }, this.min);
    },
    // 接口模拟
    getPrizeApi() {
      return new Promise((res) => {
        setTimeout(() => {
          res({ code: 200, content: 1 });
        }, 100);
      });
    },
    /*
        index 格子下标位置
        disabled 是否是禁用格子的点击事件
        fn 后端接口请求获取奖品
    */
    getPrize(index, disabled = this.disabled, fn = this.getPrizeApi) {
      // 禁用格子点击事件
      if (disabled) {
        return;
      }
      // 没有抽奖次数
      if (this.number == 0) {
        Toast("没有抽奖次数");
        return;
      }
      // 重复点击（index === 4）是九宫格最中间的位置
      if (index === 4 || index === "start") {
        if (this.flag) {
          // 监听父组件事件
          this.$emit("start");
          this.flag = false;
          fn()
            .then((res) => {
              if (res.code == 200) {
                // 随机获取奖品开始转圈动画
                this.start(Math.floor(Math.random() * 10 - 1));
              }
            })
            .catch((error) => {
              console.log(error);
            });
        } else {
          Toast("请勿重复点击");
        }
      }
    }
  }
};
</script>
```

```css
<style lang="less" scoped>
.run-light {
  display: flex;
  flex-wrap: wrap;
  width: 100%;
  height: 100%;
  justify-content: center;
  align-content: start;
  div {
    display: flex;
    align-items: center;
    justify-content: center;
  }
}
.light {
  background: rgba(252, 211, 4, 0.5) !important;
}
.opacity {
  background: transparent !important;
}
</style>
```

组件调用示例
```html
<template>
  <ensdRunLight
    class="gift-bag__run"
    :gap="6"
    ref="run_prize"
    :number="info.num"
    @start="change"
    :disabled="true"
  >
    <template>
      <div class="gift-bag__num">
        <div>{{ info.num }}</div>
        <div>剩余抽奖次数</div>
      </div>
    </template>
  </ensdRunLight>
</template>
```

<!-- more -->
