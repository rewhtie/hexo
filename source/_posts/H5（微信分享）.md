---
title: H5 å¾®ä¿¡åˆ†äº«
data: 2022-08-12 12:00
tags: H5
---

H5 å”¤èµ·å¾®ä¿¡æœ‹å‹åœˆåˆ†äº«ï¼Œéœ€è¦åœ¨å¾®ä¿¡ç¯å¢ƒä¸‹


<!-- more -->

#### å°è£…çš„ä¸€å¥—å¾®ä¿¡åˆ†äº«åŠŸèƒ½

```js
import axios from 'axios'

export const initScript = callBack => {
  let st = document.createElement('script')
  let s = document.getElementsByTagName('script')[0]
  st.src = 'https://res2.wx.qq.com/open/js/jweixin-1.6.0.js'
  st.onload = () => {
    callBack()
  }
  s.parentNode.insertBefore(st, s)
}
export const wechatShareAgain = (shareData) => {
  initScript(() => {
    axios({
      method: 'post',
      url: process.env.VUE_APP_BASE_URL + 'åç«¯æ¥å£åœ°å€',
      data: {
        url: window.location.href,
      },
    }).then(({ status, data }) => {
      if (status === 200) {
        if (data.status === 200) {
          wechatShareConfig(data.data, shareData)
        }
      }
    })
  })
}

export const wechatShareConfig = (signatureData, shareData = {}) => {
  window.wx.config({
    debug: false,
    appId: signatureData.appId,
    timestamp: signatureData.timestamp,
    nonceStr: signatureData.nonceStr,
    signature: signatureData.signature,
    jsApiList: [
      'checkJsApi',
      'hideMenuItems',
      'updateAppMessageShareData',
      'updateTimelineShareData',
    ],
  })

  window.wx.ready(function () {
    window.wx.checkJsApi({
      jsApiList: ['updateAppMessageShareData', 'updateTimelineShareData'],
      success: function () {},
    })
    window.wx.updateAppMessageShareData({
      title: shareData.title, // åˆ†äº«æ ‡é¢˜
      desc: shareData.desc, // åˆ†äº«æè¿°
      link: shareData.link, // åˆ†äº«é“¾æ¥ï¼Œè¯¥é“¾æ¥åŸŸåæˆ–è·¯å¾„å¿…é¡»ä¸å½“å‰é¡µé¢å¯¹åº”çš„å…¬ä¼—å·JSå®‰å…¨åŸŸåä¸€è‡´
      imgUrl: shareData.imgUrl, // åˆ†äº«å›¾æ ‡
      success: function () {
        // è®¾ç½®æˆåŠŸ
      },
    })
    window.wx.updateTimelineShareData({
      title: shareData.title, // åˆ†äº«æ ‡é¢˜
      link: shareData.link, // åˆ†äº«é“¾æ¥ï¼Œè¯¥é“¾æ¥åŸŸåæˆ–è·¯å¾„å¿…é¡»ä¸å½“å‰é¡µé¢å¯¹åº”çš„å…¬ä¼—å·JSå®‰å…¨åŸŸåä¸€è‡´
      imgUrl: shareData.imgUrl, // åˆ†äº«å›¾æ ‡
      success: function () {
        // è®¾ç½®æˆåŠŸ
      },
    })
    window.wx.hideMenuItems({
      // è¦éšè—çš„èœå•é¡¹ï¼Œåªèƒ½éšè—â€œä¼ æ’­ç±»â€å’Œâ€œä¿æŠ¤ç±»â€æŒ‰é’®ï¼Œæ‰€æœ‰menué¡¹è§é™„å½•3
      menuList: [
        'menuItem:share:qq',
        'menuItem:share:weiboApp',
        'menuItem:share:facebook',
        'menuItem:share:QZone',
      ],
    })
  })
  window.wx.error(function (err) {
    console.log('è·å–å¾®ä¿¡é…ç½®å¤±è´¥ï¼š', err)
  })
}
```

#### é¡µé¢è°ƒç”¨ä¼ å‚ï¼ˆåˆ†äº«éœ€è¦å³ä¸Šè§’ä¸‰ä¸ªç‚¹å•Šï¼Œåˆ«æƒ³ç€ç‚¹å‡»äº‹ä»¶è§¦å‘ï¼‰
> å‘ç‚¹ï¼šç”±äºå¾®ä¿¡ä¸ä¿¡ä»»å¤–éƒ¨é“¾æ¥ï¼Œè°ƒä¸èµ·åˆ†äº«å“ˆï¼Œéœ€è¦æŠŠé“¾æ¥ç”ŸæˆäºŒç»´ç  [è‰æ–™äºŒç»´ç å®˜ç½‘](https://cli.im/mob) å¾®ä¿¡æ‰«ç æ‰“å¼€ï¼Œåˆ†äº«åŠŸèƒ½æ‰èƒ½æ­£å¸¸ä½¿ç”¨ï¼ˆå½“æ—¶å¡äº†æˆ‘ä¸€å¤©ï¼ŒåºŸäº†ï¼‰
 ç›®å‰å¾®ä¿¡å·²ç»ä¸æ”¯æŒåˆ†äº«æˆåŠŸä¹‹åçš„å›è°ƒäº†
[å®˜ç½‘æ–‡æ¡£]ï¼ˆhttps://developers.weixin.qq.com/community/develop/doc/00060c661882b0cd62e9d083d51800?highLine=onMenuShareTimelineï¼‰
```js

import { wechatShareAgain } from "@/utils/wx"; //æˆ‘å°è£…çš„æ—¶å€™æ”¾åœ¨utils/wx.jsæ–‡ä»¶é‡Œ

const params = {
  title: "æ‹¼å…®å…®",
  link: window.location.origin + window.location.pathname,
  desc: "å¿«æ¥å¸®æˆ‘ç ä¸€åˆ€ğŸ”ª",
  imgUrl:
    "https://img.ejiayou.com/upload/2021/9/4af87209-bd4c-4731-b7e7-d81b6a44c455-1631860931489.png"
},

wechatShareAgain(params)

```

<!-- more -->
