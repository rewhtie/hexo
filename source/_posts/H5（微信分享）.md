---
title: H5 微信分享
data: 2022-08-12 12:00
tags: H5
---

H5 唤起微信朋友圈分享，需要在微信环境下


<!-- more -->

#### 封装的一套微信分享功能

```js
import axios from 'axios'

export const initScript = callBack => {
  let st = document.createElement('script')
  let s = document.getElementsByTagName('script')[0]
  st.src = 'https://res2.wx.qq.com/open/js/jweixin-1.6.0.js'
  st.onload = () => {
    callBack()
  }
  s.parentNode.insertBefore(st, s)
}
export const wechatShareAgain = (shareData) => {
  initScript(() => {
    axios({
      method: 'post',
      url: process.env.VUE_APP_BASE_URL + '后端接口地址',
      data: {
        url: window.location.href,
      },
    }).then(({ status, data }) => {
      if (status === 200) {
        if (data.status === 200) {
          wechatShareConfig(data.data, shareData)
        }
      }
    })
  })
}

export const wechatShareConfig = (signatureData, shareData = {}) => {
  window.wx.config({
    debug: false,
    appId: signatureData.appId,
    timestamp: signatureData.timestamp,
    nonceStr: signatureData.nonceStr,
    signature: signatureData.signature,
    jsApiList: [
      'checkJsApi',
      'hideMenuItems',
      'updateAppMessageShareData',
      'updateTimelineShareData',
    ],
  })

  window.wx.ready(function () {
    window.wx.checkJsApi({
      jsApiList: ['updateAppMessageShareData', 'updateTimelineShareData'],
      success: function () {},
    })
    window.wx.updateAppMessageShareData({
      title: shareData.title, // 分享标题
      desc: shareData.desc, // 分享描述
      link: shareData.link, // 分享链接，该链接域名或路径必须与当前页面对应的公众号JS安全域名一致
      imgUrl: shareData.imgUrl, // 分享图标
      success: function () {
        // 设置成功
      },
    })
    window.wx.updateTimelineShareData({
      title: shareData.title, // 分享标题
      link: shareData.link, // 分享链接，该链接域名或路径必须与当前页面对应的公众号JS安全域名一致
      imgUrl: shareData.imgUrl, // 分享图标
      success: function () {
        // 设置成功
      },
    })
    window.wx.hideMenuItems({
      // 要隐藏的菜单项，只能隐藏“传播类”和“保护类”按钮，所有menu项见附录3
      menuList: [
        'menuItem:share:qq',
        'menuItem:share:weiboApp',
        'menuItem:share:facebook',
        'menuItem:share:QZone',
      ],
    })
  })
  window.wx.error(function (err) {
    console.log('获取微信配置失败：', err)
  })
}
```

#### 页面调用传参（分享需要右上角三个点啊，别想着点击事件触发）
> 坑点：由于微信不信任外部链接，调不起分享哈，需要把链接生成二维码 [草料二维码官网](https://cli.im/mob) 微信扫码打开，分享功能才能正常使用（当时卡了我一天，废了）
 目前微信已经不支持分享成功之后的回调了
[官网文档]（https://developers.weixin.qq.com/community/develop/doc/00060c661882b0cd62e9d083d51800?highLine=onMenuShareTimeline）
```js

import { wechatShareAgain } from "@/utils/wx"; //我封装的时候放在utils/wx.js文件里

const params = {
  title: "拼兮兮",
  link: window.location.origin + window.location.pathname,
  desc: "快来帮我砍一刀🔪",
  imgUrl:
    "https://img.ejiayou.com/upload/2021/9/4af87209-bd4c-4731-b7e7-d81b6a44c455-1631860931489.png"
},

wechatShareAgain(params)

```

<!-- more -->
