---
title: 人类的精华是一代代的头发凝聚而成
data: 2023-06-30 15：46：45
tags:
  - 收录
top: true
---

开发遇到的坑点整理，小细节让自己更多的时间摸鱼吧

<!-- more -->

## 子组件v-show失效（vue3）

- 问题： v-show控制子组件显示隐藏失效

- 思考：目前理解不了

- 解决：子组件里面有模态框，确保template标签下只有一个子标签（同vue2写法）

- 案例：子组件里面有dialog组件，放在template同级下出现了这种情况



## 图标引入失效（element组件库）

- 问题：图标无效

- 思考：无

- 解决： 
    - <font color='red'>npm install @element-plus/icons     （官网下载的包不行，换一个就ok）</font>
    - <font color='red'>import {  ArrowLeftBold  } from '@element-plus/icons'</font>


- 案例：图标一直不展示


## upload上传器（element组件库）

- 问题：自定义上传文件（二进制文件上传校验）

- 思考：before-upload上传文件前的钩子函数，参数为上传的文件。 若返回 false 或者返回 Promise 且被 reject，则终止上传。

- 解决：借助before-upload钩子函数，我们可以return一个Promise.reject（），借此在promise里面做校验处理

- 案例：无


## vue框架keep-alive缓存问题（踩坑）

- 组件必须写name值并且不能重复，要不然缓存不会生效

- vue3中使用了keep-alive缓存的页面，不要把注释写在和根节点同级的位置，不然很可能很有几率的报一些莫名其妙的错误

- 用keep-alive尽量使用include和exclude来动态缓存组件，这样更好控制也更明确。不要一股脑全塞进去，不然有的页面要缓存有点页面不需要缓存，在我们跳转到一个不需要缓存的页面，肯定会把我们之前缓存的组件全部干掉，导致所有页面都不缓存


## video、audio标签使用会出现的问题

- 无总时长：src地址是后台服务器读取音频文件后，回写的数据流并且响应头不包含Content-Length。

- 拖动条不能拖动问题：后端需要继续增加响应头 Content-Range, Accept-Ranges

后台代码示例
```js
response.setHeader("Cache-Control","max-age=31536000, must-revalidate");
if (fileName.contains(".mp4")) {
   response.setContentType("video/mpeg4");
}
if (fileName.contains(".mp3")) {
   response.setContentType("audio/mpeg");
   response.setHeader("Accept-Ranges:", "bytes");
}
```

- 包裹video、audio标签的外层div无法自适应高度

<font color='red'>原因是video数据还没加载完，只有初始宽度，没有初始高度（默认0）、通过style设置高度好像也不会生效</font>

<font color='blue'>页面假如有多个加载的时候会导致最外层的div已经渲染结束 获取到的高度是 0 ，这时候页面展示会出现样式错乱，资源加载快就没有这个问题（实现代码如下）</font>

```ts
const onloadDomMessage = () => {
  let viewHeight = document.getElementById('app').clientHeight
  // viewHeight 动态设置元素高度
}
const videos = document.getElementsByTagName('video') // 获取页面所有的video进行遍历，执行获取页面高度
for (let i = 0; i < videos.length; i++) {
  let video = videos[i]
  video.addEventListener('loadedmetadata', onloadDomMessage())
}
```

<font color='red'>object-fit语法、听说也能实现，目前没验证过</font>

```html
<video width="320" height="240" controls="controls" class="video">
```
```css
.video{
  object-fit: fill | contain | cover | none | scale-down
}
```

## vue后台管理项目左菜单栏伸缩-影响右侧内容宽度（可变宽不能缩小）

>右侧容器css属性 overflow-x: hidden 解决

## 元素粘性定位顶部 滚动条滚动到一定高度粘性定位元素失效

```css
.header {
  position: sticky;
  top: 0;
}
```

>最外层的app设置了高度 height：100vh 或者 设置了一定高度， 子元素高度 比 app高度 大，这时候滚动超出 100vh 之后 就把 相当于 app 向上滚动了，导致元素粘性定位失效。
<font color='red'>解决：app或外层去除高度，子元素自适应撑开。</font>

## el-table后端返回10条数据、但是表格莫名其妙只展示了8条数据

<font color='red'>prop必传字段是空的，有时候接口字段是对象嵌套藏的很深，找半天，傻逼element不会报错没有任何提示，直接给数据隐藏了</font>
<font color='red'>prop一定不能为空！！！</font>

```html
<el-table-column label="编号" prop="id"></el-table-column>
```

## el-tree组件一堆坑点

<font color='red'>勾选相关的api</font>

```ts
//默认勾选的节点的 key 的数组	
:default-checked-keys="[SP1000, SP2000]"	

//默认展开的节点的 key 的数组	
:default-expanded-keys="[SP1000, SP2000]"

//是否在点击节点的时候选中节点，默认值为 false，即只有在点击复选框时才会选中节点。	
:check-on-click-node="true"	

//展示数据
:data="treeData"	

// label对应树形展示文本，children子节点，对应treeData对象属性
:props="{ label: 'display_name', children: 'child_permission' }" 
```

```ts
const spRouter = this.$refs.spRouter	

// getCheckedKeys获取勾选项，getHalfCheckedKeys获取已经被勾选了的子节点的父节点
const spRouterKeys = [...spRouter.getCheckedKeys(), ...spRouter.getHalfCheckedKeys()]

// 设置某个节点是否被选中，常常配合同时勾选另一项使用
spRouter.setChecked(SP1000, true)
```

- 勾选节点：父节点作为被勾选项，回显的时候会导致子节点下的所有项被勾选（非常隐蔽，找不出问题）

<font color='blue'>解决方案一：check-strictly设置为true，父子节点脱离关系</font>

```html
<el-tree :check-strictly="true">
```

<font color='blue'>解决方案二：怼死后端，只传勾选最小级别的节点给后端，后端自己处理关系，组装好数据结构返回</font>

<font color='blue'>解决方案三：数据处理，只保留最小级的节点（最小级节点需要有共性，约定好就ok）</font>

```ts
const spRouterKeys = res.data
  .filter(item => {
    if (item.item_type == 99) {
      return item
    }
  })
  .map(item => item.name)
```

## el-cascader 级联选择器回显问题

- 最后一级是空的时候不展示

<font color='blue'>只需要把chilhren变为undefined即可</font>

```ts
const removeEmptyItems = (arr) => {
  const newArr = []
  for (let i = 0; i < arr.length; i++) {
    const item = arr[i]
    if (item.children?.length >= 1) {
      item.children = this.removeEmptyItems(item.children)
    } else {
      item.children = undefined
    }
    newArr.push(item)
  }
  return newArr
},
```

- 数据回显

<font color='blue'>传给后端是字符串或者数字，但是回显需要变成数组，如 'a' --- ['a']才能正常回显</font>

- 清除数据之后，二级列表还是展示，应该只展示第一层列表才对

```ts
this.$refs.knowPointRef.$refs.panel.menus = [this.$refs.knowPointRef.$refs.panel.store.getNodes()]
```

<!-- more -->
